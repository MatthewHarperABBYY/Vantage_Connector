{
  "$schema": "https://unpkg.com/@camunda/zeebe-element-templates-json-schema/resources/schema.json",
  "name": "ABBYY Vantage â€“ Get OAuth Token - WORKING",
  "id": "vantage-get-oauth-token",
  "version": 5,
  "description": "POST client_credentials to obtain an OAuth access token",
  "category": {
    "id": "connectors",
    "name": "Connectors"
  },
  "appliesTo": [
    "bpmn:Task"
  ],
  "elementType": {
    "value": "bpmn:ServiceTask"
  },
  "groups": [
    {
      "id": "server",
      "label": "Server"
    },
    {
      "id": "parameters",
      "label": "Parameters"
    },
    {
      "id": "requestBody",
      "label": "Request body"
    },
    {
      "id": "output",
      "label": "Output mapping"
    },
    {
      "id": "error",
      "label": "Error handling"
    },
    {
      "id": "retries",
      "label": "Retries"
    }
  ],
  "properties": [
    {
      "value": "io.camunda:http-json:1",
      "binding": {
        "type": "zeebe:taskDefinition",
        "property": "type"
      },
      "type": "Hidden"
    },
    {
      "id": "baseUrl",
      "label": "Base URL",
      "description": "Auth server base URL",
      "value": "{{secrets.VANTAGE_BASE_URL}}",
      "constraints": {
        "notEmpty": true
      },
      "group": "server",
      "binding": {
        "type": "zeebe:input",
        "name": "baseUrl"
      },
      "type": "String"
    },
    {
      "id": "operationPath",
      "label": "Path",
      "value": "/auth2/connect/token",
      "constraints": {
        "notEmpty": true
      },
      "group": "server",
      "binding": {
        "type": "zeebe:input",
        "name": "operationPath"
      },
      "type": "String"
    },
    {
      "id": "method",
      "value": "POST",
      "binding": {
        "type": "zeebe:input",
        "name": "method"
      },
      "type": "Hidden"
    },
    {
      "id": "headers",
      "value": "={\"Content-Type\": \"application/x-www-form-urlencoded\", \"Accept\": \"application/json\"}",
      "binding": {
        "type": "zeebe:input",
        "name": "headers"
      },
      "type": "Hidden"
    },
    {
      "id": "url",
      "value": "= baseUrl + operationPath",
      "binding": {
        "type": "zeebe:input",
        "name": "url"
      },
      "type": "Hidden"
    },
    {
      "id": "clientId",
      "label": "Client ID",
      "value": "{{secrets.VANTAGE_CLIENT_ID}}",
      "constraints": {
        "notEmpty": true
      },
      "group": "parameters",
      "binding": {
        "type": "zeebe:input",
        "name": "clientId"
      },
      "type": "String"
    },
    {
      "id": "clientSecret",
      "label": "Client secret",
      "value": "{{secrets.VANTAGE_CLIENT_SECRET}}",
      "constraints": {
        "notEmpty": true
      },
      "group": "parameters",
      "binding": {
        "type": "zeebe:input",
        "name": "clientSecret"
      },
      "type": "String"
    },
    {
      "id": "scopes",
      "label": "Scopes (space-separated)",
      "value": "openid permissions global.wildcard",
      "group": "parameters",
      "binding": {
        "type": "zeebe:input",
        "name": "scopes"
      },
      "type": "String"
    },
    {
      "id": "body",
      "label": "Body (form-encoded)",
      "description": "POST data for client_credentials",
      "value": "= \"grant_type=client_credentials\" + \"&client_id=\" + clientId + \"&client_secret=\" + clientSecret + \"&scope=\" + replace(scopes, \" \", \"%20\")",
      "feel": "required",
      "group": "requestBody",
      "binding": {
        "type": "zeebe:input",
        "name": "body"
      },
      "type": "Text"
    },
    {
      "id": "resultVariable",
      "label": "Result variable",
      "value": "vantageAuthRaw",
      "group": "output",
      "binding": {
        "type": "zeebe:taskHeader",
        "key": "resultVariable"
      },
      "type": "String"
    },
    {
      "id": "resultExpression",
      "label": "Result expression",
      "description": "Maps access token to process variables",
      "value": "= { auth: { accessToken: body.access_token, tokenType: body.token_type, expiresIn: body.expires_in, scope: body.scope } }",
      "feel": "required",
      "group": "output",
      "binding": {
        "type": "zeebe:taskHeader",
        "key": "resultExpression"
      },
      "type": "Text"
    },
    {
      "id": "errorExpression",
      "label": "Error expression",
      "value": "= if status >= 400 then { code: status, message: body } else null",
      "feel": "required",
      "group": "error",
      "binding": {
        "type": "zeebe:taskHeader",
        "key": "errorExpression"
      },
      "type": "Text"
    },
    {
      "id": "retryCount",
      "label": "Retries",
      "value": "3",
      "group": "retries",
      "binding": {
        "type": "zeebe:taskDefinition",
        "property": "retries"
      },
      "type": "String"
    },
    {
      "id": "retryBackoff",
      "label": "Retry backoff",
      "value": "PT5S",
      "group": "retries",
      "binding": {
        "type": "zeebe:taskHeader",
        "key": "retryBackoff"
      },
      "type": "String"
    }
  ],
  "icon": {
    "contents": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNDI5LjU5IDQzMC4xIj4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmNscy0xIHsKICAgICAgICBmaWxsOiAjZmYyMDM4OwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Im0xMzQwLjI4LDBsLTMwLjMsMTM4Ljc2Yy00Ljc4LDIxLjI3LTcuOTcsNDEuNDctMTIuMjMsNzAuNzFoLTIuNjZjLTQuMjUtMjkuMjQtNy40NC00OS40NC0xMi4yMy03MC43MUwxMjUyLjU2LDBoLTk1LjE2bDkxLjQ0LDMwMC45MXYxMjkuMTloODkuMzJ2LTEyOS4xOUwxNDI5LjU5LDBoLTg5LjMyWiIvPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0ibTEwMzIuNDUsMTM4Ljc2Yy00Ljc4LDIxLjI3LTcuOTcsNDEuNDctMTIuMjMsNzAuNzFoLTIuNjZjLTQuMjUtMjkuMjQtNy40NC00OS40NC0xMi4yMy03MC43MUw5NzUuMDQsMGgtOTUuMTZsOTEuNDQsMzAwLjkxdjEyOS4xOWg4OS4zMnYtMTI5LjE5TDExNTIuMDcsMGgtODkuMzJsLTMwLjMsMTM4Ljc2WiIvPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0ibTIwNy4zNCwwaC0xMTkuMDlMMCw0MzAuMWg5MC4zOGwxNS4xNC05Ny4yOWg4MC44M2wxNS4xNCw5Ny4yOWg5NC4xTDIwNy4zNCwwWm0tOTAuOSwyNjIuNjNsMjAuMTktMTI5LjcyYzMuMTktMjAuMiw1LjMyLTM5Ljg3LDcuOTctNjcuNTJoMi42NmMyLjY2LDI3LjY1LDQuNzgsNDcuMzIsNy45Nyw2Ny41MmwyMC4xOSwxMjkuNzJoLTU4Ljk5WiIvPgogIDxwYXRoIGNsYXNzPSJjbHMtMSIgZD0ibTUxNy44MiwyMDEuNDl2LS41M2MzMC44NC0xMC42Myw1Mi42My00Mi41Myw1Mi42My04OC4yNSwwLTY5LjExLTM5LjM0LTExMi43MS0xMjMuMzQtMTEyLjcxaC0xMTkuNjJ2NDMwLjFoMTI3LjA2Yzg2LjEzLDAsMTI1LjQ3LTQ2Ljc4LDEyNS40Ny0xMjQuNCwwLTU5LjU0LTI0LjQ2LTkwLjkxLTYyLjItMTA0LjJabS0xMDMuMTQtMTM5LjI5aDI0LjQ2YzI4LjcxLDAsNDMuMDYsMTYuNDgsNDMuMDYsNTguNDhzLTE0LjM1LDU4LjQ4LTQzLjA2LDU4LjQ4aC0yNC40NlY2Mi4yWm0zMS45LDMwNS43aC0zMS45di0xMjguNjZoMzEuOWMyOS4yNCwwLDQyLjUzLDE4LjYxLDQyLjUzLDY0LjMzcy0xMy4yOSw2NC4zMy00Mi41Myw2NC4zM1oiLz4KICA8cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Im04MTQuNDgsMjAxLjQ5di0uNTNjMzAuODQtMTAuNjMsNTIuNjMtNDIuNTMsNTIuNjMtODguMjUsMC02OS4xMS0zOS4zNC0xMTIuNzEtMTIzLjM0LTExMi43MWgtMTE5LjYydjQzMC4xaDEyNy4wNmM4Ni4xMywwLDEyNS40Ny00Ni43OCwxMjUuNDctMTI0LjQsMC01OS41NC0yNC40Ni05MC45MS02Mi4yLTEwNC4yWm0tMTAzLjE0LTEzOS4yOWgyNC40NmMyOC43MSwwLDQzLjA2LDE2LjQ4LDQzLjA2LDU4LjQ4cy0xNC4zNSw1OC40OC00My4wNiw1OC40OGgtMjQuNDZWNjIuMlptMzEuOSwzMDUuN2gtMzEuOXYtMTI4LjY2aDMxLjljMjkuMjQsMCw0Mi41MywxOC42MSw0Mi41Myw2NC4zM3MtMTMuMjksNjQuMzMtNDIuNTMsNjQuMzNaIi8+Cjwvc3ZnPg=="
  }
}